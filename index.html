<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>TribeFlow by flaviovdf</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>TribeFlow</h1>
        <p>TribeFlow source code</p>

        <p class="view"><a href="https://github.com/flaviovdf/tribeflow">View the Project on GitHub <small>flaviovdf/tribeflow</small></a></p>


        <ul>
          <li><a href="https://github.com/flaviovdf/tribeflow/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/flaviovdf/tribeflow/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/flaviovdf/tribeflow">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><a name="top"></a></p>

<h1>
<a id="tribeflow" class="anchor" href="#tribeflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>TribeFlow</h1>

<ol>
<li><a href="#top">Home</a></li>
<li><a href="#data">Datasets</a></li>
<li><a href="#competition">Competing Methods</a></li>
</ol>

<p>Contains the TribeFlow (previously node-sherlock) source code.</p>

<h2>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<p>The python dependencies are:</p>

<ul>
<li>Mpi4Py</li>
<li>numpy</li>
<li>scipy</li>
<li>cython</li>
<li>pandas</li>
<li>plac</li>
</ul>

<p>You will also need to install and setup: </p>

<ul>
<li>OpenMP</li>
<li>MPI</li>
</ul>

<h2>
<a id="how-to-install-dependencies" class="anchor" href="#how-to-install-dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to install dependencies</h2>

<p><em>Easy way:</em> Install <a href="https://www.continuum.io/">Anaconda Python</a> and 
set it up as your default enviroment.</p>

<p><em>Hard way:</em> Use pip or your package manager to install the dependencies. </p>

<div class="highlight highlight-source-shell"><pre>pip install numpy
pip install scipy
pip install cython
pip install pandas
pip install mpi4py
pip install plac</pre></div>

<p>Use or package manager (<em>apt</em> on Ubuntu, <em>HomeBrew</em> on a mac) to install
OpenMP and MPI. These are the managers I tested with. Should work on any
other environment.</p>

<h2>
<a id="how-to-compile" class="anchor" href="#how-to-compile" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to compile</h2>

<p>Simply type <code>make</code></p>

<div class="highlight highlight-source-shell"><pre>make</pre></div>

<h2>
<a id="how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to use</h2>

<p>Either use <code>python setup.py install</code> to install the packager or just use it from
the package folder using the <code>run_script.sh</code> command.</p>

<p><em>How to parse datasets:</em> Use the <code>scripts/trace_converter.py</code> script. It has a help.</p>

<p>For command line help:</p>

<div class="highlight highlight-source-shell"><pre>$ python scripts/trace_converter.py -h
$ python main.py -h</pre></div>

<p>Running with mpi</p>

<div class="highlight highlight-source-shell"><pre>$ mpiexec -np 4 python main.py [OPTIONS]</pre></div>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h2>

<p><strong>Converting the Trace</strong></p>

<p>Let's we have a trace like the Last.FM trace from <a href="http://www.dtic.upf.edu/%7Eocelma/MusicRecommendationDataset/lastfm-1K.html">Oscar
Celma</a>.
In this example, each line is of the form:</p>

<div class="highlight highlight-source-shell"><pre>userid <span class="pl-cce">\t</span> timestamp <span class="pl-cce">\t</span> musicbrainz-artist-id <span class="pl-cce">\t</span> artist-name <span class="pl-cce">\t</span>
musicbrainz-track-id <span class="pl-cce">\t</span> track-name</pre></div>

<p>For instance:</p>

<div class="highlight highlight-source-shell"><pre>user_000001 2009-05-01T09:17:36Z    c74ee320-1daa-43e6-89ee-f71070ee9e8f
Impossible Beings   952f360d-d678-40b2-8a64-18b4fa4c5f8Dois PÃ³los</pre></div>

<p>First, we want to convert this file to our input format. We do this with the
<code>scripts/trace_converter.py</code> script. Let's have a look at the options from
this script:</p>

<div class="highlight highlight-source-shell"><pre>$ python scripts/trace_converter.py -h
usage: trace_converter.py [-h] [-d DELIMITER] [-l LOOPS] [-r SORT] [-f FMT]
                          [-s SCALE] [-k SKIP_HEADER] [-m MEM_SIZE]
                          original_trace tstamp_column hypernode_column
                          obj_node_column

positional arguments:
  original_trace        The name of the original trace
  tstamp_column         The column of the <span class="pl-k">time</span> stamp
  hypernode_column      The column of the <span class="pl-k">time</span> hypernode
  obj_node_column       The column of the object node

optional arguments:
  -h, --help            show this <span class="pl-c1">help</span> message and <span class="pl-c1">exit</span>
  -d DELIMITER, --delimiter DELIMITER
                        The delimiter
  -l LOOPS, --loops LOOPS
                        Consider loops
  -r SORT, --sort SORT  Sort the trace
  -f FMT, --fmt FMT     The format of the date <span class="pl-k">in</span> the trace
  -s SCALE, --scale SCALE
                        Scale the <span class="pl-k">time</span> by this value
  -k SKIP_HEADER, --skip_header SKIP_HEADER
                        Skip these first k lines
  -m MEM_SIZE, --mem_size MEM_SIZE
                        Memory Size (the markov order is m - 1)</pre></div>

<p>The positional (obrigatory) arguments are:</p>

<ul>
<li>
<em>original_trace</em> is the input file</li>
<li>
<em>hypernode_column</em> represents the users (called hypernodes since it can 
 be playlists as well)</li>
<li>
<em>tstamp_column</em> the column of the time stamp</li>
<li>
<em>obj_node_column</em> the objects of interest</li>
</ul>

<p>We can convert the file with the following line:</p>

<div class="highlight highlight-source-shell"><pre>python scripts/trace_converter.py scripts/test_parser.dat 1 0 2 -d<span class="pl-s"><span class="pl-pds">$'</span><span class="pl-cce">\t</span><span class="pl-pds">'</span></span> \
        -f<span class="pl-s"><span class="pl-pds">'</span>%Y-%m-%dT%H:%M:%SZ<span class="pl-pds">'</span></span> <span class="pl-k">&gt;</span> trace.dat</pre></div>

<p>Here, we are saying that column 1 are the timestamps, 0 is the user, and 2 are the
objects (artist ids). The delimiter <em>-d</em> is a tab. The time stamp format is
<code>'%Y-%m-%dT%H:%M:%SZ'</code>.</p>

<p><strong>Learning the Model</strong></p>

<p>The example below is the same code used for every result in the paper. It runs
TribeFlow with the options used in every result in the paper. Explaining the
parameters:</p>

<ul>
<li>
<em>-np 4</em> Number of cores for execution.</li>
<li>
<em>100</em> topics.</li>
<li>
<em>output.h5</em> model file.</li>
<li>
<em>--kernel eccdf</em> The kernel heuristic for inter-event time estimation. ECCDF
 based as per described on the paper. We also have a t-student kernel.</li>
<li>
<em>--residency_priors 1 99</em> The priors for the inter-event time estimation.</li>
<li>
<em>--leaveout 0.3</em> Number of transitions to leaveout.</li>
<li>
<em>--num_iter 2000</em> Number of iterations.</li>
<li>
<em>--num_batches 20</em> Number of split/merge moves.</li>
</ul>

<div class="highlight highlight-source-shell"><pre>$ mpiexec -np 4 python main.py trace.dat 100 output.h5 \
    --kernel eccdf --residency_priors 1 99 \
    --leaveout 0.3 --num_iter 2000 --num_batches 20</pre></div>

<p><a name="data"></a></p>

<h1>
<a id="datasets" class="anchor" href="#datasets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Datasets</h1>

<p>To come!</p>

<p><a name="competition"></a></p>

<h1>
<a id="competing-methods" class="anchor" href="#competing-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Competing Methods</h1>

<ul>
<li><a href="http://github.com/flaviovdf/plme">PRLME</a></li>
<li><a href="http://github.com/flaviovdf/fpmc">FPMC</a></li>
<li><a href="http://www.cs.cornell.edu/people/tj/playlists/index.html">LME</a></li>
<li><a href="https://github.com/flaviovdf/tribeflow/blob/master/scripts/gravity_model.py">Gravity Model</a></li>
<li><a href="https://github.com/flaviovdf/tribeflow/blob/master/scripts/tmlda.py">TMLDA</a></li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/flaviovdf">flaviovdf</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
